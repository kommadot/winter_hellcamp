# building_owner

심효빈

~~라이트업을 좀 참고 했습니다.~~

![스크린샷 2018-01-08 오후 8.39.03](/Users/simhyobin/Desktop/스크린샷 2018-01-08 오후 8.39.03.png)

실행시 건물을 짓는 메뉴가 나온다  

1번은 아파트를 만들고

2번을 회사를

3번은 레스토랑을 만든다

![스크린샷 2018-01-26 오후 9.34.22](/Users/simhyobin/Desktop/스크린샷 2018-01-26 오후 9.34.22.png)

new 함수를 통해서 힙에 생성하게 되므로 버퍼오버플로우는 아니다

각 건물을 짓게되면 이름,층,호,설명 등이 있는데 입력해주면된다.

회사나 레스토랑으로 갈수록 항목수가 많아진다 여기선 문제될게 없는데

관리메뉴에서 각 건물을 다른 건물로 변경할수있는 부분이 있는데

항목수 차이에서 문제가 생긴다 만약 아파트 -> 레스토랑으로 변경하게되면 레스토랑은 아파트보다 항목수가 더 많은데 추가로 입력을 받는것이 없어서 추가입력이 없는 항목은 메모리에 입력되어있는 값 그대로 나오게된다![스크린샷 2018-01-28 오후 10.45.55](/Users/simhyobin/Desktop/스크린샷 2018-01-28 오후 10.45.55.png)

저 93824994431216을 16진수로 바꾸면 

0x55555576D0F0 이 나온다![스크린샷 2018-01-28 오후 10.45.43](/Users/simhyobin/Desktop/스크린샷 2018-01-28 오후 10.45.43.png)이는 아래에 해당하는 0x5555576d0f0 이다 1번건물의 normal price of menu가 있어야할 위치에 다른 건물의 이름을 가르키는 포인터값이 있기때문에 릭이 생긴것이다. 그러므로 만약 저부분을 읽기를 원하는 주소로 바꾼다면 저건물의 이름이 내가 가르킨주소에 있는 값을 읽어내므로 릭이 가능하게 된다. 

그리고 만약 이름을 길게 입력하게 되면![스크린샷 2018-01-28 오후 10.51.41](/Users/simhyobin/Desktop/스크린샷 2018-01-28 오후 10.51.41.png)

0x55555576d1c0 에 보이듯이 0x7f~가 나오게 되는데 이부분은 

![스크린샷 2018-01-28 오후 10.51.54](/Users/simhyobin/Desktop/스크린샷 2018-01-28 오후 10.51.54.png)

libc영역이므로 libc주소를 릭할수있다.

그리고 normal_price_of_menu를 원하는 주소로 바꾼뒤 이름의 위치가 바뀐 건물의 이름을 바꾸면 그 주소에 해당하는 값도 바뀌게 된다. 그래서 

저 주소와 malloc_hook과 oneshot가젯을 이용해서 malloc_hook에 원샷가젯을 입력하면 프로그램을 종료할때 free를 하는데 이때 malloc_hook에 값이 있으면 그 값을 실행하게 되므로 쉘이 얻어진다.![스크린샷 2018-01-28 오후 10.57.54](/Users/simhyobin/Desktop/스크린샷 2018-01-28 오후 10.57.54.png)